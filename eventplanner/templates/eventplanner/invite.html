<html>
<title>{{title}}</title>

<link rel="stylesheet" href="http://code.jquery.com/ui/1.8.18/themes/base/jquery-ui.css" type="text/css" media="all" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" type="text/javascript"></script>

<style>
.user_table {
    margin-top: 20px;
    border-spacing: 10px;
}
.user_table th {
    background-color: lightblue;
    border-bottom: 1px solid #ddd;
    border-collapse: collapse;
    border-spacing: 5px;
}
.user_table tr {
}
.user_table tr:hover {
    background-color: #ddd;
}
.user_table td {
    border-bottom: 1px solid #ddd;
    padding: 0px;
}

    
</style>
<h1>Erstelle die Einladung f√ºr {{title}}</h1>
<table>
<tr>
<td>Ort</td><td>{{location}}</td>
</tr>
<tr>
<td>Datum</td><td>{{date}}</td>
</tr>
</table>
<script>
$(function() {
  $("#groups").autocomplete({
    source: "../contacts/get_grouplist",
    minLength: 1,
    select: function( event, ui ) {
        update_user_table_group(ui);
      },

  });
});

$(function() {
  $("#users").autocomplete({
    source: "../contacts/get_memberlist",
    minLength: 1,
    select: function( event, ui ) {
        update_user_table_group(ui);
      },

  });
});


function update_user_table_group(ui) {
    $.get('../contacts/get_members?group_name='+ui.item.label, function(members) {
        $('#user_table').html(members);
        console.log(members);
        members = JSON.parse(members)
        
        // Get Headers 
        var col = [];
        for (var i = 0; i < members.length; i++) {
            for (var key in members[i]) {
                if (col.indexOf(key) === -1) {
                    col.push(key);
                }
            }
        }
        var table = document.createElement("table");
        table.className = "user_table";
        var tr = table.insertRow(-1);                   // TABLE ROW.
        col.unshift("Export");
        col.push("");
        for (var i = 0; i < col.length; i++) {
            var th = document.createElement("th");      // TABLE HEADER.
            th.innerHTML = col[i];
            tr.appendChild(th);
        }
        col.pop();
        col.shift();
        console.log(col.length);
        for (var i = 0; i < members.length; i++) {
            tr = table.insertRow(-1);
            var checkbox = document.createElement("INPUT");
            checkbox.setAttribute("type", "checkbox");
            checkbox.setAttribute("checked", "True");
            checkbox.setAttribute("name", "userid");
            checkbox.setAttribute("value", members[i]['ID']);
            tr.appendChild(checkbox);
            for (var j = 0; j < col.length; j++) {
                var tabCell = tr.insertCell(-1);
                tabCell.innerHTML = members[i][col[j]];
                console.log(col[j]);
                if (col[j] == "ID") {
                    console.log("Needed to be removed from visible part");
                }

            }
        }
        var divContainer = document.getElementById("user_table_div");
        divContainer.innerHTML = "";
        divContainer.appendChild(table);

   });
};

</script>

<form method="POST" action="send_invite">
    {% csrf_token %}
    Gruppe <label for="groups"> <input type id="groups">
    User   <label for="user"> <input type id="users">
    <input type="submit" value="Einladung verschicken">
    <input type=hidden name="event_id" value={{ event_id }} >
</form>
<div id="user_table_div">
{% csrf_token %}
</div>

</html>
